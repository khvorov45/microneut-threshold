---
title: "Microneut Threshold"
author: "Arseniy Khvorov"
date: "`r format(Sys.time(), '%d %B, %Y')`"
mainfont: LiberationSans
sansfont: LiberationSans
monofont: LiberationMono
output:
  bookdown::pdf_document2:
    keep_tex: no
    toc: no
    latex_engine: xelatex
---

# Overview

The goal of this analysis is to find a diagnostic threshold titre against COVID-19 of the microneutralisation assay.

This is predicated on the idea that infected people have higher titres than non-infected people. An illustration is in Figure \@ref(fig:sim-hist-cont).

(ref:sim-hist-cont) Simulated titre data. Most non-infected people have undetectable titres (the solid line, simulated from $N(1, 1)$ on the log-scale). Most infected people have detectable titres centered around 80 (the dashed line, simulated from $N(4, 1)$ on the log-scale).

```{r sim-hist-cont, echo=FALSE, fig.align='center', fig.cap='(ref:sim-hist-cont)'}
knitr::include_graphics("../data-plot/sim-hist-cont.pdf")
```

Looking at Figure \@ref(fig:sim-hist-cont), we can draw a vertical line at any titre value to act as a threshold. Anyone to the left of the line would be considered not infected, anyone to the right --- infected. The proportion of the titre distribution for the uninfected (the solid line) to the left of the line would be the specificity of the test and the proportion of the titre distribution for the infected (the dashed line) to the right of the line would be the sensitivity of the test.

# Model

I considered a linear model for the log-titres

\begin{gather*}
T \sim N(\mu, \sigma) \\
\mu = \beta_0 + \beta_1 I
\end{gather*}

Where $T$ is the log-titre and $I$ is the infection status indicator (1 --- infected, 0 --- not infected).

Undetectable titres (below 20) were given a value of 10. I treated this value as if it were an actual measurement of 10.

# Model fitting

I fit the linear model using least squares.

Estimates of sensitivity $\hat{e}$ and specificity $\hat{p}$ at any threshold $t$ can be calculated from the model estimates $\hat{\beta}_0$, $\hat{\beta}_1$ and $\hat{r}$ (estimated residual error) as follows

\begin{gather*}
\hat{e} = 1 - \Phi(\frac{t - (\hat{\beta}_0 + \hat{\beta}_1)}{r}) \\
\hat{p} = \Phi(\frac{t - \hat{\beta}_0}{r})
\end{gather*}

Where $\Phi$ is the standard normal CDF. The bounds for the above estimates can be obtained by finding the bounds of the linear predictor $\hat{\beta}_0 + \hat{\beta}_1 I$ and applying the above transformations on them.

# Results

Interval estimates for sensitivity and specificity of threshold-based tests are presented in Figure \@ref(fig:testchar).

(ref:testchar) Estimated sensitivity (top panel) and specificity (bottom panel) of a threshold titre test. Bounds of the shaded region are the 95% confidence interval. The solid line is the median estimate.

```{r testchar, echo=FALSE, fig.align='center', fig.cap='(ref:testchar)'}
knitr::include_graphics("../testchar-plot/suellen-testchar.pdf")
```
# Code

Code that generated all of these results is here

https://github.com/khvorov45/microneut-threshold
